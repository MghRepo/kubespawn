<!DOCTYPE HTML>
<html lang="fr" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Réseautage - Kubespawn</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../preface.html"><strong aria-hidden="true">1.</strong> Préface</a></li><li class="chapter-item expanded "><a href="../../architecture/index.html"><strong aria-hidden="true">2.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../architecture/reseautage.html"><strong aria-hidden="true">2.1.</strong> Réseautage</a></li></ol></li><li class="chapter-item expanded "><a href="../../systemd_nspawn/index.html"><strong aria-hidden="true">3.</strong> Systemd-nspawn</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../systemd_nspawn/gestion.html"><strong aria-hidden="true">3.1.</strong> Gestion</a></li><li class="chapter-item expanded "><a href="../../systemd_nspawn/configuration/index.html"><strong aria-hidden="true">3.2.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../systemd_nspawn/configuration/controle-ressources.html"><strong aria-hidden="true">3.2.1.</strong> Contrôle des ressources</a></li><li class="chapter-item expanded "><a href="../../systemd_nspawn/configuration/reseautage.html" class="active"><strong aria-hidden="true">3.2.2.</strong> Réseautage</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../nspawn_rocky8/index.html"><strong aria-hidden="true">4.</strong> Nspawn Rocky8</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../nspawn_rocky8/preparation-image.html"><strong aria-hidden="true">4.1.</strong> Préparation de l'image</a></li><li class="chapter-item expanded "><a href="../../nspawn_rocky8/construction-deploiement.html"><strong aria-hidden="true">4.2.</strong> Construction de l'image et déploiement</a></li></ol></li><li class="chapter-item expanded "><a href="../../wireguard/index.html"><strong aria-hidden="true">5.</strong> WireGuard</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../wireguard/chargement-module.html"><strong aria-hidden="true">5.1.</strong> Chargement du module</a></li></ol></li><li class="chapter-item expanded "><a href="../../bastion/index.html"><strong aria-hidden="true">6.</strong> Machine Bastion</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../bastion/installation.html"><strong aria-hidden="true">6.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../../bastion/systemd_homed/index.html"><strong aria-hidden="true">6.2.</strong> Systemd-homed</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../bastion/systemd_homed/homectl.html"><strong aria-hidden="true">6.2.1.</strong> Homectl</a></li><li class="chapter-item expanded "><a href="../../bastion/systemd_homed/stockage-luks.html"><strong aria-hidden="true">6.2.2.</strong> Stockage LUKS</a></li></ol></li><li class="chapter-item expanded "><a href="../../bastion/administration.html"><strong aria-hidden="true">6.3.</strong> Administration</a></li><li class="chapter-item expanded "><a href="../../bastion/configuration.html"><strong aria-hidden="true">6.4.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../bastion/wireguard.html"><strong aria-hidden="true">6.5.</strong> WireGuard</a></li><li class="chapter-item expanded "><a href="../../bastion/nftables.html"><strong aria-hidden="true">6.6.</strong> Nftables</a></li></ol></li><li class="chapter-item expanded "><a href="../../infra/index.html"><strong aria-hidden="true">7.</strong> Machine d'infrastructure</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../infra/configuration.html"><strong aria-hidden="true">7.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../infra/wireguard.html"><strong aria-hidden="true">7.2.</strong> WireGuard</a></li><li class="chapter-item expanded "><a href="../../infra/shorewall.html"><strong aria-hidden="true">7.3.</strong> Shorewall</a></li></ol></li><li class="chapter-item expanded "><a href="../../cnode/index.html"><strong aria-hidden="true">8.</strong> Machine cnode</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../cnode/configuration.html"><strong aria-hidden="true">8.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../cnode/kubernetes.html"><strong aria-hidden="true">8.2.</strong> Kubernetes</a></li></ol></li><li class="chapter-item expanded "><a href="../../wnode/index.html"><strong aria-hidden="true">9.</strong> Machine wnode</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../wnode/configuration.html"><strong aria-hidden="true">9.1.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../../wnode/podman-crun.html"><strong aria-hidden="true">9.2.</strong> Podman et Crun</a></li><li class="chapter-item expanded "><a href="../../wnode/cri-o.html"><strong aria-hidden="true">9.3.</strong> CRI-O</a></li></ol></li><li class="chapter-item expanded "><a href="../../open_vswitch/index.html"><strong aria-hidden="true">10.</strong> Open vSwitch</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../open_vswitch/ponts-et-interfaces.html"><strong aria-hidden="true">10.1.</strong> Création des ponts et connexion des interfaces</a></li><li class="chapter-item expanded "><a href="../../open_vswitch/activation-conteneurs.html"><strong aria-hidden="true">10.2.</strong> Activation des conteneurs</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Kubespawn</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="systemd-nspawn"><a class="header" href="#systemd-nspawn">Systemd-nspawn</a></h1>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="réseautage"><a class="header" href="#réseautage">Réseautage</a></h3>
<p>Les conteneurs <em>systemd-nspawn</em> peuvent utiliser soit le réseautage hôte soit un réseautage privé :</p>
<ul>
<li>Dans le <strong>mode hôte</strong>, le conteneur a un accès total au réseau de l'hôte. Cela signifie que le
conteneur sera capable d'accéder à tous les services réseaux sur l'hôte et que les paquets venant
du conteneur apparaîtront pour le réseau externe comme venant de l'hôte (même adresse IP).</li>
<li>Dans le <strong>mode privé</strong>, le conteneur est déconnecté du réseau de l'hôte. Cela rend les interfaces
réseau de l'hôte indisponibles pour le conteneur :
<ul>
<li>Une interface existante peut être assigné au conteneur</li>
<li>Une interface réseau virtuelle associée à une interface existante (interface VLAN) peut être
créée et assignée au conteneur</li>
<li>Un lien Ethernet virtuel entre l'hôte est le conteneur peut être créé.
Dans le dernier cas le conteneur est complètement isolé (du réseau externe ainsi que des autres
conteneurs) et nécessite une configuration entre l'hôte et les conteneurs. Généralement cela
implique des créer des ponts pour connecter les interfaces physique ou virtuelles ou paramétrer le
NAT entre les multiples interfaces.</li>
</ul>
</li>
</ul>
<p>Le réseautage hôte est adapté aux <em>conteneurs d'application</em> qui n'exécutent pas de logiciel de
réseautage qui configure l'interface assignée.</p>
<p>Le réseautage privé est adapté aux <em>conteneur systèmes</em> qui doivent être isolés du système hôte. La
création de liens Ethernet virtuels est un outil flexible pour permettre la création de réseaux
virtuels privés complexes. C'est le mode par défaut pour les conteneurs démarrés via <em>machinectl</em> ou
<em>systemd-nspawn@.service</em>.</p>
<h4 id="utiliser-un-lien-ethernet-virtuel"><a class="header" href="#utiliser-un-lien-ethernet-virtuel">Utiliser un lien Ethernet virtuel</a></h4>
<p>Si un lien virtuel Ethernet est créé entre l'hôte et le conteneur dans le mode réseautage privé :</p>
<ul>
<li>Le côté hôte du lien sera disponible comme une interface réseau <em>ve-nomConteneur</em>.</li>
<li>Le côté conteneur du lien sera nommé <em>host0</em></li>
</ul>
<blockquote>
<p><strong>Remarque</strong> : Les liens Ethernet virtuels sont des &quot;devices&quot;. Ils peuvent agir comme des tunnels
entre des espaces de noms réseau pour faire un pont entre deux points. Une paire interconnectée
peut être créée avec la commande <em>ip link add nom-p1 type veth peer name nom-p2</em>.</p>
</blockquote>
<p>Quand on démarre le conteneur, une adresse IP doit être assignée aux deux interfaces (sur l'hôte et
dans le conteneur). Si on utilise <strong>systemd-networkd</strong> cela est réalisé automatiquement, sur l'hôte
ainsi que dans le conteneur :</p>
<ul>
<li>le fichier <em>/usr/lib/systemd/network/80-container-ve.network</em> sur l'hôte vérifie l'interface
<em>ve-nomConteneur</em> et démarre un serveur DHCP, qui assigne les adresses IP sur l'interface de
l'hôte.</li>
<li>le fichier <em>/usr/lib/systemd/network/80-container-host0.network</em> dans le conteneur vérifie
l'interface <em>host0</em> et démarre un client DHCP, qui reçoit les adresses IP de l'hôte.</li>
</ul>
<p><em>80-container-ve.network</em> :</p>
<pre><code class="language-ini ignore">[Match]
Name=ve-*
Driver=veth

[Network]
# Default to using a /28 prefix, giving up to 13 addresses per container.
Address=0.0.0.0/28
LinkLocalAddressing=yes
DHCPServer=yes
IPMasquerade=both
LLDP=yes
EmitLLDP=customer-bridge
IPv6SendRA=yes
</code></pre>
<p><em>80-container-host0.network</em> :</p>
<pre><code class="language-ini ignore">[Match]
Virtualization=container
Name=host0

[Network]
DHCP=yes
LinkLocalAddressing=yes
LLDP=yes
EmitLLDP=customer-bridge

[DHCP]
UseTimezone=yes
</code></pre>
<blockquote>
<p><strong>Remarque</strong> : Lorsqu'on examine les interfaces avec <em>ip link</em>, les noms d'interfaces affichent un
suffixe, tel que <em>ve-nomconteneur@if2</em> et <em>host0@if9</em>. Le <em>@ifN</em> ne complète pas en réalité le nom
de l'interface, <em>ip link</em> ajoute cette information pour indiquer à quel slot est connecté le câble
ethernet virtuel à l'autre bout.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../systemd_nspawn/configuration/controle-ressources.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../nspawn_rocky8/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../systemd_nspawn/configuration/controle-ressources.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../nspawn_rocky8/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
